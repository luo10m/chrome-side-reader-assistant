# 翻译功能测试指南

## 功能概述

Chrome-Side-Reader-Assistant 的翻译功能通过集成 OpenAI API 提供高质量的文本翻译服务。该功能支持多语言翻译、划词翻译、以及智能上下文感知翻译。

## 技术架构

### 前端组件
- **UI模块**: `src/js/modules/translate.js`
- **样式文件**: `src/css/translate.css`
- **国际化**: `locale/en.json`, `locale/zh_cn.json`

### 后端组件
- **消息处理**: `chrome/background.js` 中的 `fetchTranslation` 处理器
- **API调用**: `fetchTranslationWithOpenAI` 函数
- **设置管理**: 通过 `chrome.storage.local` 存储API配置

## 测试前准备

### 1. 环境配置
- 确保Chrome浏览器已安装
- 启用开发者模式
- 配置OpenAI API密钥

### 2. 扩展加载
1. 打开Chrome -> 扩展程序 -> 开发者模式
2. 点击"加载已解压的扩展程序"
3. 选择项目根目录
4. 确认扩展已成功加载

### 3. API配置
1. 打开扩展侧边栏
2. 进入设置页面
3. 配置OpenAI API密钥和基础URL
4. 保存设置

## 功能测试清单

### 基础翻译功能

#### 测试用例1：手动输入翻译
**步骤**：
1. 打开扩展侧边栏
2. 切换到翻译标签页
3. 在源文本框输入："Hello, world!"
4. 选择目标语言："Chinese (Simplified)"
5. 点击"翻译"按钮

**预期结果**：
- 按钮显示加载状态
- 结果区域显示："你好，世界！"
- 按钮恢复正常状态

#### 测试用例2：语言切换
**步骤**：
1. 设置源语言为"English"
2. 设置目标语言为"Chinese (Simplified)"
3. 点击语言切换按钮

**预期结果**：
- 源语言变为"Chinese (Simplified)"
- 目标语言变为"English"

#### 测试用例3：划词翻译
**步骤**：
1. 在网页上选择一段英文文本
2. 切换到翻译标签页
3. 验证选中文本自动填入源文本框

**预期结果**：
- 选中的文本自动出现在源文本框中
- 可以直接进行翻译

### 错误处理测试

#### 测试用例4：API密钥错误
**步骤**：
1. 在设置中配置无效的API密钥
2. 尝试翻译文本

**预期结果**：
- 显示清晰的错误信息
- 按钮恢复正常状态
- 不会卡在加载状态

#### 测试用例5：网络错误
**步骤**：
1. 断开网络连接
2. 尝试翻译文本

**预期结果**：
- 显示网络错误信息
- 用户界面保持响应

#### 测试用例6：空文本处理
**步骤**：
1. 不输入任何文本
2. 点击翻译按钮

**预期结果**：
- 显示提示信息："请输入要翻译的文本"
- 不发送API请求

### 用户体验测试

#### 测试用例7：复制功能
**步骤**：
1. 完成一次翻译
2. 点击结果区域的复制按钮
3. 在其他地方粘贴

**预期结果**：
- 显示"已复制"提示
- 剪贴板包含翻译结果

#### 测试用例8：清除功能
**步骤**：
1. 在源文本框输入文本
2. 点击清除按钮

**预期结果**：
- 源文本框清空
- 光标聚焦到源文本框

#### 测试用例9：键盘快捷键
**步骤**：
1. 在源文本框输入文本
2. 按Enter键（不按Shift）

**预期结果**：
- 自动触发翻译
- 等同于点击翻译按钮

## 性能测试

### 测试用例10：长文本翻译
**步骤**：
1. 输入超过1000字的长文本
2. 进行翻译

**预期结果**：
- 能够正确处理长文本
- 响应时间合理（<30秒）
- 翻译质量保持良好

### 测试用例11：并发翻译
**步骤**：
1. 快速连续点击翻译按钮多次

**预期结果**：
- 只有一个翻译请求被处理
- 按钮正确禁用/启用
- 不会出现重复请求

## 兼容性测试

### 浏览器兼容性
- Chrome 88+
- Edge 88+
- 其他Chromium内核浏览器

### 语言支持测试
测试以下语言对的翻译：
- 英语 ↔ 中文（简体）
- 英语 ↔ 中文（繁体）
- 英语 ↔ 日语
- 英语 ↔ 韩语
- 英语 ↔ 法语
- 英语 ↔ 德语
- 英语 ↔ 西班牙语

## 自动化测试

### 运行测试脚本
```bash
# 在项目根目录运行
node tests/test_translate.js
```

### 测试覆盖率
- 消息传递机制
- API调用逻辑
- 错误处理流程
- UI状态管理

## 问题排查

### 常见问题

1. **翻译失败**
   - 检查API密钥配置
   - 验证网络连接
   - 查看控制台错误信息

2. **界面无响应**
   - 检查扩展是否正确加载
   - 验证权限配置
   - 重新加载扩展

3. **翻译质量问题**
   - 检查源语言设置
   - 验证目标语言选择
   - 尝试调整输入文本

### 调试工具
- Chrome开发者工具
- 扩展程序调试页面
- 控制台日志输出

## 测试报告模板

```markdown
# 翻译功能测试报告

## 测试环境
- Chrome版本：
- 扩展版本：
- 操作系统：
- 测试时间：

## 测试结果
- 通过测试用例：X/Y
- 失败测试用例：
- 发现问题：

## 问题详情
1. 问题描述
2. 复现步骤
3. 预期结果
4. 实际结果
5. 严重程度

## 建议
- 功能改进建议
- 用户体验优化
- 性能优化建议
```

## 更新记录

- 2024-01-XX: 创建翻译功能测试指南
- 2024-01-XX: 添加自动化测试脚本
- 2024-01-XX: 完善错误处理测试用例 